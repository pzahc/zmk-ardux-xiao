#include <dt-bindings/led/led.h>

/*
 * WS2812B LED strip via I2S on the Seeed XIAO nRF52840.
 *
 * I2S pin assignments (D8/D9/D10 are the SPI header, repurposed):
 *   SDOUT = P1.14 (D9)  — data line to WS2812B strip
 *   SCK   = P1.13 (D8)  — I2S bit clock (unused, leave unconnected)
 *   LRCK  = P1.15 (D10) — I2S word clock (unused, leave unconnected)
 *
 * The board's default pinctrl claims P1.13/P1.14/P1.15 for SPI2,
 * so we disable SPI2 to free those pins.
 */

/* Disable SPI2 which claims P1.13/P1.14/P1.15 in the board's default pinctrl. */
&spi2 {
    status = "disabled";
};

&pinctrl {
    i2s0_default: i2s0_default {
        group1 {
            psels = <NRF_PSEL(I2S_SCK_M, 1, 13)>,   /* D8  — unused clock */
                    <NRF_PSEL(I2S_LRCK_M, 1, 15)>,   /* D10 — unused clock */
                    <NRF_PSEL(I2S_SDOUT, 1, 14)>;     /* D9  — data to LEDs */
        };
    };
};

i2s_led: &i2s0 {
    status = "okay";
    pinctrl-0 = <&i2s0_default>;
    pinctrl-names = "default";
};

/ {
    led_strip: ws2812 {
        compatible = "worldsemi,ws2812-i2s";

        i2s-dev = <&i2s_led>;
        chain-length = <13>; /* 8 key LEDs + 5 battery LEDs */
        color-mapping = <LED_COLOR_ID_GREEN
                         LED_COLOR_ID_RED
                         LED_COLOR_ID_BLUE>;
        out-active-low;       /* nRF52 I2S SDOUT idles high — invert for WS2812 */
        reset-delay = <120>;  /* 120 us reset/latch delay (WS2812B needs >= 50 us) */
    };
};
